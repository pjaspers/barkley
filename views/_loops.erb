<table class="loops">
  <colgroup>
    <col style="width: 19%"/>
    <% [1,2,3,4,5].each do |i| %>
      <col style="width: 9%">
      <col style="width: 9%">
    <% end %>
  </colgroup>
  <thead>
    <tr>
      <th class="loops__header">
        Name
      </th>
      <% [1,2,3,4,5].each do |i| %>
        <% if i > 1 %>
          <th class="loops__header">
            <div>
              <span>Loop <%=i %></span>
              <span>start</span>
            </div>
          </th>
        <% end %>

        <th class="loops__header">
          <div>
            <span>Loop <%=i %></span>
            <span>finish</span>
          </div>
        </th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% Barkley.sorted_loops.each do |nickname, (runner,loops)| %>
      <tr class="loops__line">
        <td class="loops__name">
          <span class="loops__name__nick"><%= nickname.to_s.split("_").map(&:capitalize).join(" ") %></span>
          <% if runner %>
            <span class="loops__name__guess">
              <a href="/r/<%= runner.key %>">
                <%= runner.profile.name %>?
              </a>
            </span>
          <% end %>
        </td>

        <% loops.each.with_index(1) do |l, i| %>
          <% if i > 1 %>
            <td>
              <% if l.started? || l.finished? %>
                <% if l.start %>
                  <% if l.start_twitter %>
                    <a href="<%= l.start_twitter %>">
                      <%= hhmmss(l.start) %>
                    </a>
                  <% else %>
                    <%= hhmmss(l.start) %>
                  <% end %>
                <% end %>
              <% end %>
            </td>
          <% end %>
          <td data-score="<%= l.score %>">
            <% if l.dnf? %>
              <span class="highlight highlight--red">DNF</span>
            <% elsif l.finished? %>
              <% if l.finish_twitter %>
                <a href="<%= l.finish_twitter %>">
                  <%= hhmmss(l.stop) %>
                </a>
              <% else %>
                <%= hhmmss(l.stop) %>
              <% end %>
            <% elsif l.started? %>
              <span class="highlight highlight--green loops__ongoing">
                <%= elapsed(l.started_at, style: "narrow") %>
              </span>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
